---
tags: [workflow, plan, latency, agent, compound-engineering]
date: 2026-02-16
category: general
status: implemented
---

# /plan 실행 시 과도한 지연 문제

## Problem

### 증상
- `/plan` skill 실행 시 리서치 에이전트(`general-purpose` Task)가 5분+ 소요
- 플랜 파일 작성 후에도 `ExitPlanMode` 승인까지 추가 대기 발생
- 사용자가 결과물을 확인하기까지 체감 10분+ 소요

### 근본 원인
1. **과도한 리서치 scope**: 단일 Task 에이전트에 8개+ 리서치 항목을 한꺼번에 요청 → 에이전트가 웹 검색, 문서 읽기를 순차적으로 수행하며 시간 폭증
2. **불필요한 리서치**: 프로젝트 코드베이스 탐색만으로 충분한 정보를 외부 검색까지 확장
3. **직렬 실행**: 코드베이스 분석과 외부 리서치를 병렬로 하지 않고 순차 실행
4. **파일 위치 안내 누락**: 플랜 파일 생성 후 사용자에게 경로를 즉시 안내하지 않음

## Solution

### 1. 리서치 범위 제한
- 외부 리서치는 **정말 모르는 것**만 (새로운 API, 서드파티 라이브러리)
- Apple HIG, Swift Charts 같은 익숙한 주제는 기존 지식 + 코드베이스 분석으로 충분
- Task 에이전트 사용 시 리서치 항목 3개 이하로 제한

### 2. 병렬 실행
- 코드베이스 탐색 (Glob, Grep, Read)과 외부 리서치 (Task agent)를 동시 실행
- 독립적인 리서치 주제는 별도 Task 에이전트로 분리 병렬화

### 3. 즉시 안내
- 플랜 파일 생성 즉시 **절대 경로** 안내
- `ExitPlanMode` 호출 전에 요약 먼저 제공
- 지연 발생 시 중간 상태 보고

### 4. F3 작업도 단계 분리
- Phase 1만 먼저 plan → 승인 → 실행 → 다음 Phase plan
- 전체를 한 번에 plan하려고 하지 말 것

## Prevention

### /plan skill 실행 시 체크리스트
1. **리서치 필요 여부 판단**: 코드베이스 내 정보로 충분한가?
2. **Task 에이전트 scope 제한**: 3개 이하 질문, `max_turns` 제한
3. **병렬 실행**: 코드베이스 탐색과 외부 리서치 동시 진행
4. **중간 보고**: 30초 이상 걸릴 것 같으면 "리서치 중입니다" 안내
5. **즉시 경로 안내**: 파일 생성 후 바로 절대 경로 출력

### 규칙 제안
`.claude/rules/`에 추가 고려:
- "Task 에이전트 리서치는 3개 질문 이하, 외부 검색은 정말 필요한 경우만"
- "플랜 파일 생성 후 즉시 절대 경로 안내"

## Lessons Learned

1. **사용자 체감 시간이 핵심**: 고품질 리서치보다 빠른 피드백이 우선. 80% 품질을 2분에 전달하는 것이 100% 품질을 10분에 전달하는 것보다 낫다
2. **리서치 에이전트는 비싸다**: general-purpose Task 에이전트는 내부적으로 수십 번의 tool call을 하므로 scope를 좁게 유지해야 함
3. **워크트리에서의 파일 경로**: 워크트리 환경에서는 절대 경로를 명시해야 사용자가 즉시 접근 가능
